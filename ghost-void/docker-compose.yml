version: '3.8'

services:
  # Node.js Server & Game Engine
  server:
    build:
      context: .
      dockerfile: Dockerfile.server
    ports:
      - "8080:8080"
    environment:
      - PORT=8080
      - NODE_ENV=production
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8080"]
      interval: 30s
      timeout: 10s
      retries: 3

  # MCP Gateway (Docker pattern)
  mcp-gateway:
    image: docker/mcp-gateway:latest
    ports:
      - "8811:8811"
    command:
      - --transport=sse
      - --servers=default # Configure servers here or via volume mount
    environment:
      - DEBUG=true

  # Jurassic Pixels Agent (Parker)
  jurassic-agent:
    build:
      context: .
      dockerfile: Dockerfile.agent
    volumes:
      - ./jurassic_pixels:/app/jurassic_pixels
      - ./adk:/app/adk
    environment:
      - SERVER_URL=ws://server:8080
    depends_on:
      - server
    command: ["python", "-m", "jurassic_pixels.parker_train", "--interactive"]
